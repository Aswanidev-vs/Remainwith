<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0" name="viewport"/>
    <title>Remainwith - Dashboard</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Newsreader:ital,opsz,wght@0,6..72,200..800;1,6..72,200..800&amp;family=Noto+Sans:wght@400;500;700&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>

    <style>
        /* --- CSS Variables & Theme Definitions --- */
        :root {
            /* Base Dimensions & Fonts */
            --font-display: "Newsreader", serif;
            --font-sans: "Noto Sans", sans-serif;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-full: 9999px;
        }

        /* 1. LIGHT THEME (Default) */
        html[data-theme="light"] {
            --primary: #7d8471;
            --bg-body: #f7f7f7;
            --card-bg: #ffffff;
            --card-border: #e7e5e4;
            --text-main: #292524;
            --text-muted: #57534e;
            --text-subtle: #a8a29e;
            --divider: #f5f5f4;
            --glow-from: #e7e5e4;
            --glow-to: #f5f5f4;
            --stone-200: #e7e5e4;
        }

        /* 2. DARK THEME */
        html[data-theme="dark"] {
            --primary: #9ca38f;
            --bg-body: #191a18;
            --card-bg: #1c1917;
            --card-border: #292524;
            --text-main: #e7e5e4;
            --text-muted: #a8a29e;
            --text-subtle: #78716c;
            --divider: #292524;
            --glow-from: #292524;
            --glow-to: #1c1917;
            --stone-200: #292524;
        }

        /* 3. SEPIA THEME */
        html[data-theme="sepia"] {
            --primary: #8a7356;
            --bg-body: #f4ecd8;
            --card-bg: #fdf6e3;
            --card-border: #e6dcc6;
            --text-main: #433422;
            --text-muted: #746351;
            --text-subtle: #a89984;
            --divider: #e6dcc6;
            --glow-from: #e6dcc6;
            --glow-to: #fdf6e3;
            --stone-200: #dccfb8;
        }

        /* 4. FOREST THEME */
        html[data-theme="forest"] {
            --primary: #76a881;
            --bg-body: #1a211e;
            --card-bg: #222b26;
            --card-border: #2f3b34;
            --text-main: #dcece1;
            --text-muted: #8ca392;
            --text-subtle: #56695e;
            --divider: #2f3b34;
            --glow-from: #2f3b34;
            --glow-to: #222b26;
            --stone-200: #2f3b34;
        }

        /* --- Reset & Base Styles --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            font-family: var(--font-display);
            min-height: 100vh;
            line-height: 1.5;
            transition: background-color 0.5s ease, color 0.5s ease;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--text-subtle); border-radius: 4px; opacity: 0.5; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

        ::selection { background-color: var(--primary); color: var(--bg-body); }

        /* Utilities */
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
            display: inline-block;
            vertical-align: middle;
        }

        /* --- Layout --- */
        .app-container {
            display: flex; flex-direction: column; align-items: center;
            width: 100%; min-height: 100vh; padding-bottom: 5rem;
        }

        /* --- Header --- */
        .app-header {
            width: 100%; max-width: 56rem;
            padding: 1rem;
            display: flex; align-items: center; justify-content: space-between;
            gap: 1rem;
        }
        @media (min-width: 640px) { .app-header { padding: 2rem 1.5rem; } }

        .logo-group {
            display: flex; align-items: center; gap: 0.5rem;
            cursor: pointer; transition: opacity 0.4s ease-in-out;
            text-decoration: none; color: inherit; flex-shrink: 0;
        }
        .logo-group:hover { opacity: 0.7; }
        .logo-text { font-size: 1.25rem; font-weight: 700; letter-spacing: -0.025em; }
        @media (min-width: 640px) { .logo-text { font-size: 1.5rem; } }

        .header-actions { display: flex; align-items: center; gap: 0.75rem; }
        @media (min-width: 640px) { .header-actions { gap: 1.25rem; } }

        .btn-link {
            display: flex; align-items: center; gap: 0.5rem;
            background: none; border: none; cursor: pointer;
            font-family: var(--font-sans); font-size: 0.875rem;
            font-weight: 500; color: var(--text-muted);
            transition: color 0.4s ease-in-out; text-decoration: none;
            padding: 0.25rem;
        }
        .btn-link:hover { color: var(--primary); }
        .btn-text { display: none; }
        @media (min-width: 640px) { .btn-text { display: inline; } }

        /* --- Theme Selector --- */
        .theme-selector-wrapper { position: relative; display: inline-flex; align-items: center; width: fit-content; }
        .icon-palette {
            position: absolute; left: 12px; top: 50%; transform: translateY(-50%);
            font-size: 18px !important; color: var(--text-muted); pointer-events: none; z-index: 2;
        }
        .theme-select {
            appearance: none; -webkit-appearance: none; cursor: pointer;
            background-color: var(--card-bg); color: var(--text-main);
            border: 1px solid var(--card-border); border-radius: var(--radius-full);
            padding: 0.6rem 2.5rem 0.6rem 38px;
            font-size: 0.9rem; font-family: var(--font-sans); font-weight: 500;
            transition: all 0.2s ease-in-out; z-index: 1;
        }
        .icon-chevron {
            position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
            font-size: 20px !important; color: var(--text-muted); pointer-events: none; z-index: 2;
        }
        .theme-select:hover { border-color: var(--primary); background-color: var(--divider); }
        .theme-selector-wrapper:hover .material-symbols-outlined { color: var(--primary); }

        /* --- Profile --- */
        .profile-pic-sm {
            height: 2rem; width: 2rem; border-radius: 9999px;
            background-size: cover; background-position: center;
            box-shadow: 0 0 0 1px var(--stone-200); cursor: pointer; flex-shrink: 0;
        }
        .profile-menu { position: relative; }
        .profile-trigger { background: none; border: none; padding: 0; cursor: pointer; }
        .profile-dropdown {
            position: absolute; right: 0; top: calc(100% + 12px); width: 240px;
            background: var(--card-bg); border: 1px solid var(--card-border);
            border-radius: var(--radius-lg); box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            padding: 0.5rem; z-index: 50; opacity: 0; transform: translateY(-8px);
            pointer-events: none; transition: all 0.25s ease;
        }
        .profile-dropdown.open { opacity: 1; transform: translateY(0); pointer-events: auto; }
        .profile-dropdown-header { padding: 0.75rem; border-bottom: 1px solid var(--divider); margin-bottom: 0.25rem; }
        .profile-item {
            display: flex; align-items: center; gap: 0.75rem; padding: 0.6rem 0.75rem;
            font-size: 0.9rem; color: var(--text-main); text-decoration: none;
            border-radius: var(--radius-md); background: none; border: none; width: 100%;
            cursor: pointer; transition: background 0.2s, color 0.2s;
        }
        .profile-item:hover { background: var(--divider); color: var(--primary); }
        .profile-item.danger { color: #c2410c; }
        .profile-item.danger:hover { background: rgba(194,65,12,0.08); }

        /* --- Main Feed --- */
        .feed-container {
            width: 100%; max-width: 600px; padding: 0 1rem;
            display: flex; flex-direction: column; gap: 2rem;
        }
        @media (min-width: 640px) { .feed-container { padding: 0 1.5rem; gap: 2.5rem; } }

        .greeting-section { text-align: center; padding: 1rem 0 0.5rem 0; animation: fadeIn 1s ease-out; }
        .greeting-title { font-size: 1.75rem; font-weight: 600; margin-bottom: 0.25rem; }
        @media (min-width: 640px) { .greeting-title { font-size: 2rem; } }
        .greeting-subtitle { font-size: 1rem; color: var(--text-muted); font-style: italic; }

        /* Composer */
        .composer-section { display: flex; flex-direction: column; gap: 1rem; }
        .composer-wrapper { position: relative; }
        .composer-glow {
            position: absolute; inset: -2px;
            background: linear-gradient(to right, var(--glow-from), var(--glow-to));
            border-radius: var(--radius-lg); opacity: 0.5; filter: blur(4px);
            transition: opacity 1s; z-index: 0;
        }
        .composer-card {
            position: relative; z-index: 1;
            background-color: var(--card-bg); border-radius: var(--radius-lg);
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            border: 1px solid var(--card-border); padding: 0.25rem;
            display: flex; flex-direction: column;
            transition: background-color 0.5s ease, border-color 0.5s ease;
        }
        .composer-textarea {
            width: 100%; background: transparent; border: none; outline: none;
            padding: 1rem; min-height: 120px; font-size: 1rem;
            font-family: var(--font-display); font-style: italic;
            color: var(--text-main); resize: none;
        }
        .composer-actions {
            display: flex; justify-content: space-between; align-items: center;
            padding: 0.75rem 1rem 0.5rem 1rem; border-top: 1px solid var(--divider);
        }
        .btn-primary {
            background-color: var(--primary); color: var(--bg-body);
            padding: 0.5rem 1.25rem; border-radius: var(--radius-md);
            font-size: 0.875rem; font-weight: 600; border: none;
            cursor: pointer; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            transition: all 0.4s ease-in-out; text-decoration: none; display: inline-block;
        }
        html[data-theme="light"] .btn-primary { color: #fff; } 
        html[data-theme="dark"] .btn-primary { color: #1c1917; }
        .btn-primary:hover { opacity: 0.9; }

        /* Dashboard Cards */
        .dashboard-grid { display: grid; grid-template-columns: 1fr; gap: 1rem; }
        @media (min-width: 600px) { .dashboard-grid { grid-template-columns: 1fr 1fr; } }
        .dashboard-card {
            background-color: var(--card-bg); border: 1px solid var(--card-border);
            border-radius: var(--radius-lg); padding: 1rem;
            display: flex; flex-direction: column; gap: 0.75rem;
            transition: all 0.4s ease-in-out; position: relative; overflow: hidden;
        }
        .dashboard-card:hover { border-color: var(--primary); box-shadow: 0 4px 12px rgba(0,0,0,0.03); }
        .db-header { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem; }
        .db-title { font-size: 1rem; font-weight: 700; color: var(--text-main); font-family: var(--font-sans); }
        .db-desc { font-size: 0.95rem; color: var(--text-muted); line-height: 1.4; font-style: italic; flex-grow: 1; }
        .db-actions { display: flex; flex-direction: column; gap: 0.5rem; margin-top: 0.5rem; }
        .btn-secondary-link {
            font-size: 0.875rem; color: var(--text-subtle); padding: 0.5rem;
            text-decoration: none; transition: color 0.3s;
        }
        .btn-secondary-link:hover { color: var(--primary); text-decoration: underline; }

        /* Feed Cards */
        .feed-list { display: flex; flex-direction: column; gap: 2rem; }
        .journal-card {
            display: flex; flex-direction: column; gap: 1rem;
            background-color: var(--card-bg); padding: 1.25rem;
            border-radius: var(--radius-lg); border: 1px solid var(--card-border);
            box-shadow: 0 2px 8px rgba(0,0,0,0.02);
            transition: background-color 0.5s ease, border-color 0.5s ease;
        }
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .user-info { display: flex; align-items: center; gap: 0.75rem; }
        .avatar { height: 2rem; width: 2rem; border-radius: 9999px; background-color: var(--stone-200); overflow: hidden; }
        .avatar img { width: 100%; height: 100%; object-fit: cover; }
        .card-content { font-size: 1.05rem; line-height: 1.6; color: var(--text-main); font-family: var(--font-display); }

        /* Footer */
        .app-footer { text-align: center; padding: 2rem 0; color: var(--text-subtle); font-family: var(--font-display); font-style: italic; }
        
        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ==========================================================================
           ONBOARDING MODAL STYLES (New Addition)
           ========================================================================== */
        
        /* Backdrop Effect */
        dialog::backdrop {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            animation: fadeIn 0.4s ease-out;
        }

        /* Modal Container */
        #onboarding-dialog {
            margin: auto;
            background: transparent;
            max-width: 600px;
            width: 95%;
            border: none;
            outline: none;
            overflow: hidden; /* For rounded corners */
            border-radius: var(--radius-lg);
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.2);
        }

        /* Modal Inner Card Structure */
        .modal-card {
            display: flex;
            flex-direction: column;
            max-height: 85vh; /* Limits height to allow internal scrolling */
            background: var(--card-bg);
            color: var(--text-main);
            padding: 0; /* Reset generic padding */
            border: 1px solid var(--card-border);
        }

        /* 1. Fixed Header */
        .modal-header {
            padding: 2rem 2rem 1rem 2rem;
            text-align: center;
            border-bottom: 1px solid var(--divider);
            background: var(--card-bg);
            flex-shrink: 0;
        }
        .modal-title { font-size: 1.75rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--text-main); font-family: var(--font-display); }
        .modal-subtitle { font-family: var(--font-sans); font-size: 0.95rem; color: var(--text-muted); }

        /* 2. Scrollable Middle Section */
        #interests-container {
            padding: 1.5rem 2rem;
            overflow-y: auto; /* Enables scroll */
            flex-grow: 1;
            scrollbar-width: thin;
            scrollbar-color: var(--text-subtle) transparent;
        }
        #interests-container::-webkit-scrollbar { width: 6px; }
        #interests-container::-webkit-scrollbar-track { background: transparent; }
        #interests-container::-webkit-scrollbar-thumb { background-color: var(--card-border); border-radius: 10px; }

        /* Categories */
        .category-section { margin-bottom: 2rem; }
        
        /* Sticky Category Title */
        .category-title {
            font-family: var(--font-sans);
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-subtle);
            margin-bottom: 1rem;
            
            /* Sticky Magic */
            position: sticky;
            top: -1.5rem; /* Matches padding-top of container */
            background: var(--card-bg);
            padding: 0.75rem 0;
            z-index: 10;
        }

        .tags-grid { display: flex; flex-wrap: wrap; gap: 0.75rem; }

        /* Tag Styling */
        .tag-checkbox { appearance: none; position: absolute; width: 0; height: 0; opacity: 0; }
        
        .tag-label {
            display: inline-flex; align-items: center; justify-content: center;
            padding: 0.6rem 1.1rem;
            background-color: transparent;
            border: 1px solid var(--card-border);
            border-radius: var(--radius-full);
            font-family: var(--font-sans);
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-muted);
            cursor: pointer;
            user-select: none;
            transition: all 0.2s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        .tag-label:hover {
            border-color: var(--primary);
            color: var(--primary);
            background-color: var(--bg-body);
        }

        /* Checked State */
        .tag-checkbox:checked + .tag-label {
            background-color: var(--primary);
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-1px);
        }

        /* Text Contrast for Active Tags */
        html[data-theme="light"] .tag-checkbox:checked + .tag-label,
        html[data-theme="sepia"] .tag-checkbox:checked + .tag-label,
        html[data-theme="forest"] .tag-checkbox:checked + .tag-label {
            color: #ffffff;
        }
        html[data-theme="dark"] .tag-checkbox:checked + .tag-label {
            color: var(--bg-body);
            font-weight: 700;
        }

        /* 3. Fixed Footer */
        .modal-footer {
            padding: 1.5rem 2rem;
            background: var(--card-bg);
            border-top: 1px solid var(--divider);
            display: flex; justify-content: space-between; align-items: center;
            flex-shrink: 0;
        }

        .btn-ghost {
            background: none; border: none;
            color: var(--text-subtle);
            font-family: var(--font-sans); font-size: 0.9rem;
            cursor: pointer; padding: 0.5rem 1rem;
            transition: color 0.2s;
        }
        .btn-ghost:hover { color: var(--text-main); text-decoration: underline; }

        /* Mobile Adjustments for Modal */
        @media (max-width: 640px) {
            #interests-container { padding: 1rem 1.25rem; }
            .modal-header, .modal-footer { padding: 1.25rem; }
            .modal-title { font-size: 1.4rem; }
            .tag-label { font-size: 0.85rem; padding: 0.5rem 0.9rem; }
        }

    </style>
</head>
<body>

    <div class="app-container">
        
        <!-- Header -->
        <header class="app-header">
            <a href="#" class="logo-group">
                <img src="/assets/Remainwith_logov1.png" alt="logo" width="200px" height="200px">
                <h1 class="logo-text">Remainwith</h1>
            </a>
            
            <div class="header-actions">
                <div class="theme-selector-wrapper">
                    <span class="material-symbols-outlined icon-palette">palette</span>
                    <select class="theme-select" id="theme-select" aria-label="Select Theme">
                        <option value="light">Light</option>
                        <option value="dark">Dark</option>
                        <option value="sepia">Sepia</option>
                        <option value="forest">Forest</option>
                    </select>
                    <span class="material-symbols-outlined icon-chevron">expand_more</span>
                </div>

                <form action="/logout" method="POST" style="display: inline;">
                    <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
                    <button type="submit" class="btn-link">
                        <span class="material-symbols-outlined">logout</span>
                        <span class="btn-text">Log out</span>
                    </button>
                </form>
                <a href="/journal" class="btn-link">
                    <span class="material-symbols-outlined">book</span>
                    <span class="btn-text">Journal</span>
                </a>
                <div class="profile-menu">
                    <button class="profile-trigger" id="profileTrigger" aria-label="Open profile menu">
                        <div class="profile-pic-sm" style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuCaI3uBIWwC1noJFyIk3WzdR7lE7FuvDxtMu1QujzaYmKoVrakvYTPQFDQHcrkBkRh032COVx_l63E38Y9ndt3--8u44XMd-sdfXVp6dIx86kaLSbo7H79rcBRUtG9RJ2YTKOEy48i7TMejv4uszIFENN3lNitzaunaswSgjCWEevSSrqm6rXrgwBM2J0hkeh9-6pWMFbgLqRvDBv95uWLpVWZ6kjJLtW8_OLT0hX8ktgSZUucU__dea8pVH4M-yCdPcVMmIKPnVkzW');"></div>
                    </button>

                    <!-- Profile Dropdown -->
                    <div class="profile-dropdown" id="profileDropdown">
                        <div class="profile-dropdown-header"><strong>Aswani</strong></div>
                        <a href="/profile" class="profile-item"><span class="material-symbols-outlined">person</span>Profile</a>
                        <a href="/settings" class="profile-item"><span class="material-symbols-outlined">settings</span>Settings</a>
                        <a href="/about" class="profile-item"><span class="material-symbols-outlined">info</span>About Remainwith</a>
                        <div class="profile-divider"></div>
                        <form action="/logout" method="POST">
                            <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
                            <button type="submit" class="profile-item danger">
                                <span class="material-symbols-outlined">logout</span>Log out
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </header>

        <main class="feed-container">
            <section class="greeting-section">
                <h2 class="greeting-title">Youâ€™re here.</h2>
                <p class="greeting-subtitle">Thereâ€™s nothing you need to prove.</p>
            </section>

            <section class="composer-section">
                <form class="composer-wrapper" action="/thoughts/create" method="POST">
                    <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
                    <div class="composer-glow"></div>
                    <div class="composer-card">
                        <textarea class="composer-textarea" name="content" placeholder="Release a thought. A sentence is enough."></textarea>
                        <div class="composer-actions">
                            <div class="icon-btn"><span class="material-symbols-outlined" style="font-size: 20px;">image</span></div>
                            <button type="submit" class="btn-primary"><span>Release quietly</span></button>
                        </div>
                    </div>
                </form>
            </section>

            <section class="dashboard-grid">
                <div class="dashboard-card">
                    <div class="db-header">
                        <span class="material-symbols-outlined">accessibility_new</span>
                        <span class="db-title">Presence Room</span>
                    </div>
                    <p class="db-desc">A quiet space to be together. Words are optional.</p>
                    <div class="db-actions">
                        <a href="/presence/join" class="btn-primary" style="text-align:center;">Join a room</a>
                        <a href="/presence/solo" class="btn-secondary-link" style="text-align:center;">Stay alone for a moment</a>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="db-header">
                        <span class="material-symbols-outlined camp-icon">local_fire_department</span>
                        <span class="db-title">Campfire</span>
                    </div>
                    <p class="db-desc">Gather around the fire. Warmth in numbers.</p>
                    <div class="db-actions">
                        <a href="/campfire" class="btn-primary" style="text-align:center;">Enter Campfire</a>
                        <a href="/campfire/about" class="btn-secondary-link" style="text-align:center;">How does it work?</a>
                    </div>
                </div>
            </section>

            <div class="presence-container">
                <span class="presence-dot-wrapper"><span class="presence-ping"></span><span class="presence-dot"></span></span>
                <p class="presence-text">12 people are sitting with you right now.</p>
            </div>

            <div class="feed-list">
                <article class="journal-card">
                    <header class="card-header">
                        <div class="user-info">
                            <div class="avatar"><img alt="Profile of Sarah" src="https://lh3.googleusercontent.com/aida-public/AB6AXuAAXd9KQMgiexIhf1LOKlZjXkTLyLpYX1IA40L2ZMag1rhYSPjSm9niYQnOTdDBVbvCmeGra5uNIPlI5CdDrSDWlhNdQqh6vCUV5Jq4P6OwFWIzEg-JUJoXR_DWhTvhqHv4bz_o4xkZqFZna1Qkr0VkrneiYcKjf3jW47N8CFlSxtD6t2aCUe_91hPW6QpjDIYqnwoOz4xbZXRBInSTZYuw36SsnKz6ey-xjXLGSSxXKxS7INEbu6dE5ylmlzDKe_KYMXx8w00g7p_T"/></div>
                            <div style="display: flex; flex-direction: column;"><span class="user-name">Sarah M.</span></div>
                        </div>
                        <span class="timestamp">Just now</span>
                    </header>
                    <div class="card-content">Trying to find the quiet between the noise of the morning commute. The city feels loud today, but my coffee is warm.</div>
                    <div class="card-footer">
                        <button class="action-btn"><span class="material-symbols-outlined">favorite</span><span class="action-label">I'm here</span></button>
                    </div>
                </article>

                <article class="journal-card">
                    <header class="card-header">
                        <div class="user-info">
                            <div class="avatar"><img alt="Profile of David" src="https://lh3.googleusercontent.com/aida-public/AB6AXuDsTb8Aim3w3EV5w5egSyPXZ42xvZhHtIf3JBSP3pguG8gp_jzphvNUIGIMCVC7urDF6T77kddBE5ak7Z5euVrCqIspE1K86iSYJcojO6Lson4pXmPx0EM5fzmWDRwxky1WcjTtw8cMLBFGHFB86dikX7hfPe4DPucgYUcgYRiiC_IRbd_eIjHLtNlsSy7wqW954WJ22RE1ODR-OfWCyPADDIjGIpGHJV1IyT6QdzBTBQFrE3NhYMeLMEidIp0G8A1RfObOrRfJQzy6"/></div>
                            <div style="display: flex; flex-direction: column;"><span class="user-name">David L.</span></div>
                        </div>
                        <span class="timestamp">2h ago</span>
                    </header>
                    <div class="card-content">Grateful for the sunlight hitting my desk. It reminds me that warmth always returns, eventually.</div>
                    <div class="card-footer">
                        <button class="action-btn"><span class="material-symbols-outlined">favorite</span><span class="action-label">3 here</span></button>
                    </div>
                </article>
            </div>

            <div class="loader-container"><span class="material-symbols-outlined spin">progress_activity</span></div>
            <footer class="app-footer"><p>Youâ€™re not behind. Youâ€™re present.</p></footer>
        </main>
    </div>

    <!-- ==========================================================================
         ONBOARDING DIALOG HTML (Populated via JS)
         ========================================================================== -->
    <dialog id="onboarding-dialog">
        <form class="modal-card" id="interests-form" method="dialog">
            <div class="modal-header">
                <h2 class="modal-title">Whatâ€™s been on your mind?</h2>
                <p class="modal-subtitle">Select up to 5. You can change this anytime.</p>
            </div>

            <!-- Content Area (Scrollable) -->
            <div id="interests-container">
                <!-- Javascript will inject categories and tags here -->
            </div>

            <div class="modal-footer">
                <button type="button" class="btn-ghost" id="btn-skip">Skip for now</button>
                <button type="submit" class="btn-primary" id="btn-save-interests">Continue</button>
            </div>
        </form>
    </dialog>

    <!-- Application Logic -->
    <script>
        // --- Theme Manager ---
        (function() {
            const htmlElement = document.documentElement;
            const themeSelect = document.getElementById('theme-select');
            const storageKey = 'remainwith-theme';

            function getCookie(name) {
                const value = `; ${document.cookie}`;
                const parts = value.split(`; ${name}=`);
                if (parts.length === 2) return parts.pop().split(';').shift();
            }

            function setCookie(name, value, days) {
                const expires = new Date();
                expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
                document.cookie = name + '=' + value + ';expires=' + expires.toUTCString() + ';path=/';
            }

            function loadTheme() {
                const savedTheme = getCookie(storageKey);
                if (savedTheme) {
                    setTheme(savedTheme);
                } else {
                    const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    setTheme(systemDark ? 'dark' : 'light');
                }
            }

            function setTheme(theme) {
                htmlElement.setAttribute('data-theme', theme);
                if(themeSelect) themeSelect.value = theme;
                setCookie(storageKey, theme, 7);
            }

            loadTheme();

            if (themeSelect) {
                themeSelect.addEventListener('change', (e) => {
                    setTheme(e.target.value);
                });
            }
        })();

        // --- Profile Menu ---
        (function () {
            const trigger = document.getElementById("profileTrigger");
            const dropdown = document.getElementById("profileDropdown");

            trigger.addEventListener("click", (e) => {
                e.stopPropagation();
                dropdown.classList.toggle("open");
            });

            document.addEventListener("click", () => {
                dropdown.classList.remove("open");
            });
        })();

        // ==========================================================================
        // ONBOARDING LOGIC
        // ==========================================================================
        (function() {
            const dialog = document.getElementById('onboarding-dialog');
            const container = document.getElementById('interests-container');
            const form = document.getElementById('interests-form');
            const skipBtn = document.getElementById('btn-skip');
            
            // Data provided in prompt
            const interestsData = [
                // ðŸ§  How Youâ€™ve Been Feeling
                { name: "Anxiety", category: "ðŸ§  How Youâ€™ve Been Feeling" },
                { name: "Overthinking", category: "ðŸ§  How Youâ€™ve Been Feeling" },
                { name: "Stress", category: "ðŸ§  How Youâ€™ve Been Feeling" },
                { name: "Loneliness", category: "ðŸ§  How Youâ€™ve Been Feeling" },
                { name: "Emotional exhaustion", category: "ðŸ§  How Youâ€™ve Been Feeling" },
                { name: "Calm & clarity", category: "ðŸ§  How Youâ€™ve Been Feeling" },
                { name: "Gratitude", category: "ðŸ§  How Youâ€™ve Been Feeling" },

                // ðŸŽ¯ What Youâ€™re Working On
                { name: "Self-discipline", category: "ðŸŽ¯ What Youâ€™re Working On" },
                { name: "Staying consistent", category: "ðŸŽ¯ What Youâ€™re Working On" },
                { name: "Finding motivation", category: "ðŸŽ¯ What Youâ€™re Working On" },
                { name: "Breaking a habit", category: "ðŸŽ¯ What Youâ€™re Working On" },
                { name: "Improving focus", category: "ðŸŽ¯ What Youâ€™re Working On" },
                { name: "Building confidence", category: "ðŸŽ¯ What Youâ€™re Working On" },

                // ðŸ§ Life Situations
                { name: "Student life", category: "ðŸ§ Life Situations" },
                { name: "Career confusion", category: "ðŸ§ Life Situations" },
                { name: "Relationship struggles", category: "ðŸ§ Life Situations" },
                { name: "Family pressure", category: "ðŸ§ Life Situations" },
                { name: "Living alone", category: "ðŸ§ Life Situations" },
                { name: "Feeling stuck", category: "ðŸ§ Life Situations" },

                // ðŸŒ± Reflection & Meaning
                { name: "Self-reflection", category: "ðŸŒ± Reflection & Meaning" },
                { name: "Finding purpose", category: "ðŸŒ± Reflection & Meaning" },
                { name: "Letting go", category: "ðŸŒ± Reflection & Meaning" },
                { name: "Acceptance", category: "ðŸŒ± Reflection & Meaning" },
                { name: "Mindfulness", category: "ðŸŒ± Reflection & Meaning" },
                { name: "Understanding myself better", category: "ðŸŒ± Reflection & Meaning" },

                // ðŸŒ™ Time & Energy States
                { name: "Late-night thoughts", category: "ðŸŒ™ Time & Energy States" },
                { name: "Low-energy days", category: "ðŸŒ™ Time & Energy States" },
                { name: "Need encouragement", category: "ðŸŒ™ Time & Energy States" },
                { name: "Quiet reflection", category: "ðŸŒ™ Time & Energy States" },
                { name: "Morning motivation", category: "ðŸŒ™ Time & Energy States" },
            ];

            // 1. Render Function
            function renderInterests(interests) {
                // Group by category
                const grouped = interests.reduce((acc, curr) => {
                    (acc[curr.category] = acc[curr.category] || []).push(curr);
                    return acc;
                }, {});

                let html = '';
                // Generate HTML for each category
                for (const [category, items] of Object.entries(grouped)) {
                    // Create safe IDs for labels
                    html += `
                        <div class="category-section">
                            <div class="category-title">${category}</div>
                            <div class="tags-grid">
                                ${items.map((item, index) => {
                                    // Generate a unique ID based on category + index to avoid collisions
                                    const safeId = category.replace(/[^a-zA-Z0-9]/g, '') + '-' + index;
                                    return `
                                        <input type="checkbox" class="tag-checkbox" name="interests" value="${item.name}" id="${safeId}">
                                        <label class="tag-label" for="${safeId}">${item.name}</label>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                }
                container.innerHTML = html;
                attachLimitListener();
            }

            // 2. Limit Selection to 5
            function attachLimitListener() {
                const checkboxes = container.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(cb => {
                    cb.addEventListener('change', () => {
                        const checked = container.querySelectorAll('input[type="checkbox"]:checked');
                        if (checked.length > 5) {
                            cb.checked = false;
                            // Simple alert for feedback
                            alert("You can select up to 5 interests.");
                        }
                    });
                });
            }

            // 3. Logic to Show Modal (Simulating "First Time Login")
            function checkAndShowOnboarding() {
                // In a real app, you might check this via API: /api/onboarding/check
                // For this demo, we use LocalStorage to simulate "Is this a new user?"
                
                const hasOnboarded = localStorage.getItem('onboarding_complete');

                // If user hasn't onboarded yet, show the modal
                if (!hasOnboarded) {
                    renderInterests(interestsData);
                    
                    // Small delay to ensure styles are loaded and DOM is ready
                    setTimeout(() => {
                        if (typeof dialog.showModal === "function") {
                            dialog.showModal();
                        } else {
                            alert("Your browser does not support the <dialog> API");
                        }
                    }, 500);
                }
            }

            // 4. Handle Save/Continue
            form.addEventListener('submit', (e) => {
                e.preventDefault(); // Prevent dialog from closing immediately by default
                
                const checked = Array.from(container.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.value);
                
                // In a real app: POST to /api/interests
                // fetch('/api/interests', { method: 'POST', body: ... })
                
                console.log("Saving Interests:", checked);
                
                // Mark onboarding as complete in simulation
                localStorage.setItem('onboarding_complete', 'true');
                
                dialog.close();
            });

            // 5. Handle Skip
            skipBtn.addEventListener('click', () => {
                console.log("Onboarding Skipped");
                // Even if skipped, mark as complete so it doesn't pop up again
                localStorage.setItem('onboarding_complete', 'true');
                dialog.close();
            });

            // Initialize
            checkAndShowOnboarding();

        })();
    </script>
</body>
</html>